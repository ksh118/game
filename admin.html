<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>관리자 - codetbase</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; background: #eee; margin: 0; padding-top: 80px; }
        .header { position: fixed; top: 0; width: 100%; background: #222; color: #fff; padding: 15px; display: flex; justify-content: space-between; z-index: 100; box-sizing: border-box; }
        .container { padding: 20px; max-width: 900px; margin: auto; }
        .card { background: #fff; margin-bottom: 10px; padding: 15px; border-radius: 10px; display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
        input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        .save-btn { background: #27ae60; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="header">
        <h2>관리자 페이지</h2>
        <button class="save-btn" onclick="saveAll()">모든 설정 일괄 저장</button>
    </div>
    <div class="container" id="list"></div>
    <div style="text-align: center;"><button onclick="addRow()" style="padding: 10px 40px; cursor:pointer;">+ 레벨 추가</button></div>

<script>
    const SUPABASE_URL = 'https://utfrjzcnefsbuadnkdud.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV0ZnJqemNuZWZzYnVhZG5rZHVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY4MjE1MTYsImV4cCI6MjA4MjM5NzUxNn0.D3Za1nMw-x0JwOpkFuYceUHlagcpRdrpFqNUIP5Kjdc';
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    let swordData = [];

    async function load() {
        const { data } = await supabaseClient.from('sword_data').select('*').order('level', { ascending: true });
        swordData = data || [];
        render();
    }

    function render() {
        const list = document.getElementById('list');
        list.innerHTML = '';
        swordData.forEach((s, i) => {
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `
                <b>LV ${s.level}</b>
                <input type="text" placeholder="검 이름" value="${s.name}" onchange="swordData[${i}].name=this.value">
                <input type="number" placeholder="비용" value="${s.upgrade_cost}" style="width:80px" onchange="swordData[${i}].upgrade_cost=Number(this.value)">
                <input type="number" step="0.1" placeholder="확률" value="${s.success_rate}" style="width:60px" onchange="swordData[${i}].success_rate=Number(this.value)">
                <input type="text" placeholder="이미지 URL" value="${s.image_url || ''}" style="flex:1" onchange="swordData[${i}].image_url=this.value">
                <button onclick="swordData.splice(${i},1); render()" style="color:red">X</button>
            `;
            list.appendChild(div);
        });
    }

    function addRow() {
        const lastLvl = swordData.length > 0 ? swordData[swordData.length-1].level : 0;
        swordData.push({ level: lastLvl+1, name: '', upgrade_cost: 1000, success_rate: 0.5, image_url: '', description: '새로운 검입니다.' });
        render();
    }

    async function saveAll() {
        await supabaseClient.from('sword_data').delete().neq('level', 0);
        await supabaseClient.from('sword_data').insert(swordData);
        alert("저장 완료! 게임에 반영되었습니다.");
    }
    load();
</script>
</body>
</html>
